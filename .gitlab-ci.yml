workflow:
  auto_cancel:
    on_new_commit: interruptible


include:
  - project: Infrastructure/freedesktop-ci-templates
    file: templates/fedora.yml

.fedora:
  extends: .fdo.distribution-image@fedora
  interruptible: true
  needs: ["docker-image"]
  variables:
    ###
    # IMPORTANT
    # These are the version tags for the docker images the CI runs against.
    # If you are hacking on them or need a them to rebuild, its enough
    # to change any part of the string of the image you want.
    ###
    FDO_DISTRIBUTION_TAG: '2025-03-25.1'
    FDO_DISTRIBUTION_VERSION: '41'
    FDO_DISTRIBUTION_PACKAGES: >
      git diffutils shellcheck devscripts
    FDO_UPSTREAM_REPO: $CI_PROJECT_PATH


stages:
  - dependencies
  - analysis


docker-image:
  extends:
    - .fedora
    - .fdo.container-build@fedora
  needs: []
  stage: dependencies
  variables:
    GIT_STRATEGY: none

meson-health:
  extends: .fedora
  stage: analysis
  script:
    - sh .gitlab/run_meson_health_diff.sh
  allow_failure: true
